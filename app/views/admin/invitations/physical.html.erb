<div class="screen-only">
  <div class="flex gap-2 mb-6 border-b border-border pb-2">
    <%= link_to "Send by Email", admin_invitations_path,
        class: "px-4 py-2 rounded-md no-underline font-medium text-secondary hover:bg-neutral-100" %>
    <%= link_to "Physical Invitations", physical_admin_invitations_path,
        class: "px-4 py-2 rounded-md no-underline font-medium bg-secondary text-white" %>
  </div>

  <div class="card">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
      <h1>Physical Invitation Builder</h1>
    </div>

    <% if @households.any? %>
      <%= form_with url: physical_admin_invitations_path, method: :get, class: "mb-8" do |f| %>
        <div class="grid gap-5 lg:grid-cols-[minmax(0,1.25fr)_minmax(0,1fr)_minmax(0,1fr)_auto] lg:items-end">
          <div class="form-group mb-0">
            <label for="household_id">Preview with household</label>
            <%= f.select :household_id,
                options_from_collection_for_select(@households, :id, :display_name, @household&.id),
                { include_blank: "Select household..." },
                { class: "form-control w-full" } %>
          </div>
          <div class="form-group mb-0">
            <label for="print_count">Invitations to print</label>
            <%= f.number_field :print_count,
                value: @print_count,
                min: 1,
                max: @households.count,
                step: 1,
                class: "form-control w-full" %>
          </div>
          <div class="form-group mb-0">
            <label for="print_side">Print set</label>
            <%= f.select :print_side,
                options_for_select(
                  [
                    ["Fronts then backs", "both"],
                    ["Fronts only", "fronts"],
                    ["Backs only", "backs"]
                  ],
                  @print_side
                ),
                {},
                { class: "form-control w-full" } %>
          </div>
          <div class="flex gap-3 items-end" data-controller="print">
            <%= f.submit "Apply Options", class: "btn btn-secondary btn-sm" %>
            <button type="button" class="btn btn-primary btn-sm" data-action="click->print#open">
              Print
            </button>
          </div>
        </div>
      <% end %>

      <p class="text-sm text-stone-500 mb-4">
        Preview and print are formatted at 5 Ã— 7 inches. Print fronts first, re-feed the stack, then print backs.
      </p>
      <p class="text-sm text-stone-500 mb-8">
        Printing <%= @print_households.count %> of <%= @households.count %> invitation<%= "s" if @households.count != 1 %>
        with <%= @print_side == "both" ? "fronts then backs" : @print_side %>.
      </p>

      <div class="invitation-preview flex flex-col lg:flex-row gap-12 items-start">
        <div class="flex flex-col gap-3">
          <p class="text-xs font-semibold tracking-wider uppercase text-stone-500">Front</p>
          <div class="border border-stone-200 rounded-lg overflow-hidden shadow-card">
            <%= render "invitation_front", household: @household if @household %>
          </div>
        </div>
        <div class="flex flex-col gap-3">
          <p class="text-xs font-semibold tracking-wider uppercase text-stone-500">Back</p>
          <div class="border border-stone-200 rounded-lg overflow-hidden shadow-card">
            <%= render "invitation_back", household: @household if @household %>
          </div>
        </div>
      </div>
      <p class="mt-4 text-sm text-stone-500">
        <%= @households.count %> invitation<%= "s" if @households.count != 1 %> (one per household)
      </p>
    <% else %>
      <p class="text-stone-600">No households found. Add households and guests to preview physical invitations.</p>
    <% end %>
  </div>
</div>

<% if @households.any? %>
  <div class="print-only">
    <% if @print_side == "both" || @print_side == "fronts" %>
      <% @print_households.each do |household| %>
        <div class="invitation-print-sheet">
          <%= render "invitation_front", household: household %>
        </div>
      <% end %>
    <% end %>
    <% if @print_side == "both" || @print_side == "backs" %>
      <% @print_households.each do |household| %>
        <div class="invitation-print-sheet">
          <%= render "invitation_back", household: household %>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
