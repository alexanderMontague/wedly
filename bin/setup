#!/bin/bash

eval "$(rbenv init - zsh)"

echo "ğŸ”§ Setting up Wedly..."
echo ""

cd "$(dirname "$0")"

echo "âœ“ Ruby version: $(ruby --version)"
echo ""

echo "ğŸ“¦ Installing dependencies..."
bundle install

if [ ! -f ../.env ]; then
  echo ""
  echo "ğŸ“ Creating .env file..."
  cp ../.env.example ../.env
  echo "âœ“ .env created (configure SMTP settings before sending emails)"
fi

echo ""
echo "ğŸ§¹ Clearing logs and temp files..."
rails log:clear
rails tmp:clear

echo ""
echo "ğŸ—„ï¸  Setting up database..."
rails db:create
rails db:migrate
rails db:seed

echo ""
echo "ğŸ¨ Building CSS..."
bundle exec tailwindcss -i app/assets/stylesheets/application.tailwind.css -o app/assets/builds/application.css --config config/tailwind.config.js

echo ""
echo "âœ… Setup complete!"
echo ""
echo "To start the server, run:"
echo "  ./bin/dev"
echo ""
echo "Admin login: http://localhost:3000/admin/login"
echo "  Email: admin@wedly.com"
echo "  Password: password"
