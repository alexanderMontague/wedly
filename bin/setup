#!/bin/bash

command -v rbenv >/dev/null 2>&1 && eval "$(rbenv init - bash 2>/dev/null)" || true

echo "ğŸ”§ Setting up Wedly..."
echo ""

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR/.."

echo "âœ“ Ruby version: $(ruby --version)"
echo ""

echo "ğŸ“¦ Installing dependencies..."
bundle install

if [ ! -f .env ]; then
  echo ""
  echo "ğŸ“ Creating .env file..."
  cp .env.example .env
  echo "âœ“ .env created (configure SMTP settings before sending emails)"
fi

echo ""
echo "ğŸ§¹ Clearing logs and temp files..."
bin/rails log:clear
bin/rails tmp:clear

echo ""
echo "ğŸ—„ï¸  Setting up database..."
bin/rails db:create
bin/rails db:migrate
bin/rails db:seed

echo ""
echo "ğŸ¨ Building CSS..."
bin/rails tailwindcss:build

echo ""
echo "âœ… Setup complete!"
echo ""
echo "To start the server, run:"
echo "  ./bin/dev"
echo ""
echo "Admin login: http://localhost:3000/admin/login"
echo "  Email: admin@wedly.com"
echo "  Password: password"
